# gmc_vps_hmm

This repository contains all code to process and analyse data as presented in... _DOI_. Data for this project is _include info about copyright_. This data is hosted on the Integrated Marine Observing System Animal Tracking Facility (IMOS ATF) [data portal](https://imos.org.au/facilities/animaltracking) under the NSW Department of Primary Industries Coastal and Estuarine Fish Tracking (CEFT) project. However, this data is under embargo until _date_.

Some analysis for this project was carried out using the High Performance Cluster (HPC) Katana hosted by UNSW ResTech, while some was performed on my personal laptop. The scripts are integrated, as in output from one flows into the next. However, this makes for a somewhat complicated workflow whereby computationally intensive parts were submitted to Katana and less intensive aspects were done locally. With this in mind, the following briefly describes the workflow and output from each step.

1. Submit `crawl.pbs` to Katana which calls `crawl.R`. This step applies some basic pre-processing to our raw data from the VPS and then estimates temporally-regular locations using a continuous-time correlated random walk (desribed in [Johnson et al., 2008](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/07-1032.1)). 
2. Process data further using `environmental.R`. This step is performed locally, and isn't very computationally intensive (although some of the functions are not very efficient). This script is used to add the environmental data to the temporally-regular locations. There is also a function for assigning acceleration values to the interpolated times (this is the slow function). Since we cannot (or at least I don't know how to) predict the acceleration values at temporally-regular intervals I have written a function to identify which interval each measurement falls in for each crab and then summarise over all measurements within an interval. E.g., between time t and t+1 there may be two (or more) acceleration measurements, this function will go an find those and return their mean as the acceleration vector for this interval.
3. Submit `hmm.pbs` to Katana which calls `hmm.R`. This is the final script to submit to Katana, it fits a hidden Markov model using `momentuHMM` to estimate crab behavioural states from the interpolated tracks. Details of this package can be found in the [paper](https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.12995), excellent [vignette](https://cran.r-project.org/web/packages/momentuHMM/vignettes/momentuHMM.pdf) or via the [GitHub repo](https://github.com/bmcclintock/momentuHMM).
4. The final stage of analysis is undertaken using `results.R` and run locally. It produces the necessary plots and output summaries.
